<!DOCTYPE html>
<html>
<head>
    <title>Altus Branch Name Validator</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 1200px; margin: 0 auto; }
        h1 { color: #011A41; }
        .test-container { margin: 20px 0; }
        button { background: #011A41; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; }
        button:hover { background: #023060; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #011A41; color: white; }
        .valid { background: #d4edda; }
        .invalid { background: #f8d7da; }
        .testing { background: #fff3cd; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üè¶ Altus Branch Name Validator</h1>
    <p>This tool tests which branch names are accepted by the Altus UAT API</p>

    <div class="test-container">
        <h2>Quick Test</h2>
        <button onclick="testSingleBranch()">Test Single Branch (Choma - Documented Example)</button>
        <button onclick="testAllBranches()">Test All 18 Branches</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <h2>Branch Test Results</h2>
    <table id="branchTable">
        <thead>
            <tr>
                <th>Branch Name</th>
                <th>Status</th>
                <th>API Response</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="branchResults">
            <tr><td colspan="4">Click "Test All Branches" to begin testing...</td></tr>
        </tbody>
    </table>

    <script>
        const API_URL = 'http://3.6.174.212:5011/API/CustomerServices/RetailCustomer';
        const BEARER_TOKEN = '0B9574489-7EC5-4373-94DA-871FDE07CF8EC3BEA3AF-C9B7-4DEA-AE35-EA1C626191C00314393C-29B4-4E60-8D11-595EDAAAC42F10';
        
        const branches = [
            'Choma',
            'Chilanga',
            'Chipata',
            'Kabwe',
            'Kalulushi',
            'Kansuswa',
            'Kasama',
            'Kitwe',
            'Livingstone',
            'Lusaka',
            'Mazabuka',
            'Mkushi',
            'Mongu',
            'Mufulira',
            'Mumbwa',
            'Ndola',
            'Serenje',
            'Solwezi'
        ];

        async function testBranch(branchName) {
            const testData = {
                body: {
                    Command: "Create",
                    FirstName: "TestUser",
                    MiddleName: "",
                    LastName: "BranchTest",
                    CustomerStatus: "Active",
                    NRCIssueDate: "2020-01-01",
                    UpdatedBy: "WebPortal",
                    PrimaryAddress: "Test Address",
                    ProvinceName: "Lusaka",
                    DistrictName: "Lusaka",
                    CountryName: "Zambia",
                    Postalcode: "10101",
                    NRCNumber: "999999/99/9",  // Fake NRC to avoid duplicates
                    ContactNo: "0999999999",
                    EmailID: `test_${Date.now()}@test.com`,  // Unique email
                    BranchName: branchName,  // THIS IS WHAT WE'RE TESTING
                    GenderName: "Male",
                    Title: "Mr",
                    DOB: "1990-01-01",
                    FinancialInstitutionName: "Test Bank",
                    FinancialInstitutionBranchName: "Test Branch",
                    AccountNumber: "1234567890",
                    AccountType: "Savings"
                }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${BEARER_TOKEN}`
                    },
                    body: JSON.stringify(testData)
                });

                const result = await response.json();
                return {
                    branch: branchName,
                    success: result.executionStatus === 'Success',
                    message: result.executionMessage,
                    response: result
                };
            } catch (error) {
                return {
                    branch: branchName,
                    success: false,
                    message: error.message,
                    response: null
                };
            }
        }

        async function testSingleBranch() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>Testing Choma (Documented Example)...</h3>';
            
            const result = await testBranch('Choma');
            
            resultsDiv.innerHTML = `
                <div class="result ${result.success ? 'success' : 'error'}">
                    <h3>Result for: ${result.branch}</h3>
                    <p><strong>Status:</strong> ${result.success ? '‚úÖ Valid' : '‚ùå Invalid'}</p>
                    <p><strong>Message:</strong> ${result.message}</p>
                    <details>
                        <summary>Full API Response</summary>
                        <pre>${JSON.stringify(result.response, null, 2)}</pre>
                    </details>
                </div>
            `;
        }

        async function testAllBranches() {
            const tbody = document.getElementById('branchResults');
            tbody.innerHTML = '';
            
            for (const branch of branches) {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${branch}</td>
                    <td class="testing">Testing...</td>
                    <td>-</td>
                    <td>-</td>
                `;

                const result = await testBranch(branch);
                
                row.className = result.success ? 'valid' : 'invalid';
                row.cells[1].textContent = result.success ? '‚úÖ Valid' : '‚ùå Invalid';
                row.cells[1].className = result.success ? 'valid' : 'invalid';
                row.cells[2].textContent = result.message;
                row.cells[3].innerHTML = `<button onclick='showDetails(${JSON.stringify(result).replace(/'/g, "\\'")})'>View Details</button>`;

                // Add delay to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            // Summary
            const validBranches = Array.from(tbody.querySelectorAll('tr.valid')).map(row => row.cells[0].textContent);
            const invalidBranches = Array.from(tbody.querySelectorAll('tr.invalid')).map(row => row.cells[0].textContent);

            document.getElementById('results').innerHTML = `
                <div class="result success">
                    <h3>üìä Test Summary</h3>
                    <p><strong>Valid Branches (${validBranches.length}):</strong> ${validBranches.join(', ') || 'None'}</p>
                    <p><strong>Invalid Branches (${invalidBranches.length}):</strong> ${invalidBranches.join(', ') || 'None'}</p>
                </div>
            `;
        }

        function showDetails(result) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="result ${result.success ? 'success' : 'error'}">
                    <h3>Details for: ${result.branch}</h3>
                    <p><strong>Status:</strong> ${result.success ? '‚úÖ Valid' : '‚ùå Invalid'}</p>
                    <p><strong>Message:</strong> ${result.message}</p>
                    <details open>
                        <summary>Full API Response</summary>
                        <pre>${JSON.stringify(result.response, null, 2)}</pre>
                    </details>
                </div>
            `;
            window.scrollTo(0, 0);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('branchResults').innerHTML = '<tr><td colspan="4">Click "Test All Branches" to begin testing...</td></tr>';
        }

        // Initial message
        console.log('Branch Name Validator loaded. Available functions:');
        console.log('- testSingleBranch() - Test Choma');
        console.log('- testAllBranches() - Test all 18 branches');
    </script>
</body>
</html>
